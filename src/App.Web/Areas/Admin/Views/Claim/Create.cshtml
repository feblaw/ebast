@using App.Web.Models.ViewModels.Core.Business
@model ClaimModelForm
@{
    ViewBag.Title = "Claim Submission | Create";
}

@section breadcrumb{
    <li>
        <a href="@Url.Action("Index")">Claim  List</a>
        <i class="fa fa-circle"></i>
    </li>
    <li>
        <span>Create</span>
    </li>
}

<h1 class="page-title">Claim Submission <small></small></h1>


<form role="form" asp-action="Create" method="post" id="FormSubmit" class="form-horizontal">
    <div class="row">
        <div class="col-lg-6">
            <div class="portlet light portlet-fit portlet-form bordered">
                <div class="portlet-title">
                    <div class="caption">
                        <span class="caption-subject font-blue sbold uppercase">CLAIM REQUEST FORM</span>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div class="portlet-body">
                    <div class="form-body">
                       
                        <div class="form-group">
                            <label asp-for="TravelReqNo" class="control-label col-md-5">
                                Travel Request No
                                <span class="text-danger"> * </span>
                            </label>
                            <div class="col-md-7">
                                <select class="form-control" asp-for="TravelReqNo" asp-items="@(new SelectList(@ViewBag.TravelNotClaim, "TravelReqNo","TravelReqNo"))" required>
                                    <option disabled selected>-- Select Travel No --</option>
                                </select>
                                <span asp-validation-for="TravelReqNo" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label asp-for="ProjectId" class="control-label col-md-5">
                                Project
                                <span class="text-danger"> * </span>
                            </label>
                            <div class="col-md-7">
                                <select class="form-control" asp-for="ProjectId" asp-items="@(new SelectList(@ViewBag.Project, "Id","Name"))" required>
                                    <option disabled selected>-- Select Project --</option>
                                </select>
                                <span asp-validation-for="ProjectId" class="text-danger"></span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label asp-for="ClaimCategoryId" class="control-label col-md-5">
                                Type of Claim
                                <span class="text-danger"> * </span>
                            </label>
                            <div class="col-md-7">
                                <select class="form-control" asp-for="ClaimCategoryId" asp-items="@(new SelectList(@ViewBag.ClaimCategory, "Id","Name"))" required>
                                    <option disabled selected>-- Select Type of Claim --</option>
                                </select>
                                <span asp-validation-for="ClaimCategoryId" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="StartDate" class="control-label col-md-5" id="DateFirst">
                                Date
                                <span class="text-danger"> * </span>
                            </label>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <input type="text" class="form-control form_datetime" id="StartDateView" readonly />
                                    <span class="input-group-btn">
                                        <button class="btn btn-secondary" type="button"><i class="fa fa-calendar"></i></button>
                                    </span>
                                </div>
                                <input type="hidden" class="form-control" asp-for="StartDate" readonly required />
                                <span asp-validation-for="StartDate" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group group12" hidden>
                            <label class="control-label col-md-5" id="TimeFirst">
                                Start Time Trip
                                <span class="text-danger"> </span>
                            </label>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <input type="time" class="time" id="StartTimeView" value="08:00" />
                                </div>
                                <br />
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="EndDate" class="control-label col-md-5" id="DateLast">
                                Date
                                <span class="text-danger"> * </span>
                            </label>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <input type="text" class="form-control form_datetime" id="EndDateView" readonly />
                                    <span class="input-group-btn">
                                        <button class="btn btn-secondary" type="button"><i class="fa fa-calendar"></i></button>
                                    </span>
                                </div>
                                <input type="hidden" class="form-control" asp-for="EndDate" readonly required />
                                <span asp-validation-for="EndDate" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group group12" hidden>
                            <label class="control-label col-md-5" id="TimeFirst">
                                End Time Trip
                                <span class="text-danger">  </span>
                            </label>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <input type="time" class="time" id="EndTimeView" value="20:00" />
                                </div>
                                <br />
                            </div>
                        </div>
                        <div class="form-group group-2">
                            <label asp-for="TripType" class="control-label col-md-5">
                                Trip Type
                                <span class="text-danger"> * </span>
                            </label>
                            <div class="col-md-7">
                                <select asp-for="TripType" asp-items="@ViewBag.TripType" class="form-control" style="width:100%">
                                    <option disabled selected>-- Select Trip Type --</option>
                                </select>
                                <span asp-validation-for="TripType" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group" id="claimValueForm">
                            <label asp-for="Value" class="control-label col-md-5">
                                Claim Value
                                <span class="text-danger"> * </span>
                            </label>
                            <div class="col-md-7">
                                <input type="text" class="form-control numeric" id="ValueView" value="" readonly>
                                <input type="hidden" value="0" asp-for="Value" required />
                                <span asp-validation-for="Value" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="Description" class="control-label col-md-5">
                                Description
                                <span class="text-danger">  </span>
                            </label>
                            <div class="col-md-7">
                                <textarea class="form-control" asp-for="Description" rows="5"></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="ClaimApproverOneId" class="control-label col-md-5">
                                RPM
                                <span class="text-danger"> * </span>
                            </label>
                            <div class="col-md-7">
                                <select class="form-control" asp-for="ClaimApproverOneId" asp-items="@(new SelectList(@ViewBag.ProjectManager, "Id","Name"))" required>
                                    <option disabled selected>-- Select  RPM --</option>
                                </select>
                                <span asp-validation-for="ClaimApproverOneId" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="ClaimApproverTwoId" class="control-label col-md-5">
                                Line Manager
                                <span class="text-danger"> * </span>
                            </label>
                            <div class="col-md-7">
                                <select class="form-control" asp-for="ClaimApproverTwoId" asp-items="@(new SelectList(@ViewBag.LineManager, "Id","Name"))" required>
                                    <option disabled selected>-- Select Line Manager --</option>
                                </select>
                                <span asp-validation-for="ClaimApproverTwoId" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="Files" class="control-label col-md-5">
                                Upload File
                                <span class="text-danger"> * </span>
                            </label>
                            <div class="col-md-7">
                                <input type="hidden" asp-for="Files" class="form-control" />
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="gallery-wrap">
                                            <div id="uploaded">
                                                <div class="shortcuts text-left">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div id="file_upload" />
                            </div>
                        </div>
                        <div class="form-group last">
                            <div class="col-md-5 col-md-offset-4">
                                <label class="text-danger">List File need to be upload:</label>
                                <label class="text-danger">- Hotel, Flight, Transport Receipt</label>
                                <label class="text-danger">- Boarding Pass & </label>
                                <label class="text-danger">Hotel Reservation</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="portlet light portlet-fit portlet-form bordered">
            <div class="portlet-title">
                <div class="caption">
                    <span class="caption-subject font-blue sbold uppercase">ALLOWANCE FORM</span>
                </div>
                <div class="pull-right">
                    <p class="form-control-static">
                        <span id="GrandValue"></span>
                        <input type="hidden" id="GrandInput" class="numeric" />
                    </p>
                </div>
                <div class="clearfix"></div>
            </div>
            <div class="portlet-body">
                <div class="form-body">
                    <div class="form-group group-1">
                        <label asp-for="DayType" class="control-label col-md-4">
                            Select Type
                            <span class="text-danger"> * </span>
                        </label>
                        <div class="col-md-8">
                            <select asp-for="DayType" asp-items="@ViewBag.DayType" class="form-control" style="width:100%">
                                <option disabled selected>-- Select Type --</option>
                            </select>
                            <span asp-validation-for="DayType" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-1">
                        <label asp-for="OnCallShift" class="control-label col-md-4">
                            Allowance Value
                        </label>
                        <div class="col-md-8">
                            <input type="text" id="OnCallShiftView" class="form-control numeric" readonly />
                            <input type="hidden" asp-for="OnCallShift" value="0" class="form-control" readonly />
                            <span asp-validation-for="OnCallShift" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 domestic">
                        <label asp-for="Domallo1" class="control-label col-md-4">
                            Flight
                        </label>
                        <div class="input-group col-md-7">
                            <span class="input-group-addon">Rp</span>
                            <input type="text" Id="Domallo1View" placeholder="Actual Reimburse" class="form-control numeric calculate" />
                            
                            <input type="hidden" asp-for="Domallo1" value="0" class="form-control" />
                            <span asp-validation-for="Domallo1" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 domestic">
                        <label asp-for="Domallo2" class="control-label col-md-4">
                            Local Transport Home-Airport-Home
                        </label>
                        <div class="input-group col-md-7">
                            <span class="input-group-addon">Rp</span>
                            <input type="text" id="Domallo2View" class="form-control numeric" placeholder="Max Rp. 250.000"/>
                            <input type="hidden" class="numeric" id="Domallo2ViewMax" />
                            <input type="hidden" asp-for="Domallo2" value="0" class="form-control" readonly />
                            <span asp-validation-for="Domallo2" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 domestic">
                        <label asp-for="Domallo3" class="control-label col-md-4">
                            Local Transport Airport-Hotel-Airport
                        </label>
                        <div class="input-group col-md-7">
                            <span class="input-group-addon">Rp</span>
                            <input type="text" id="Domallo3View" class="form-control numeric" placeholder="Max Rp. 250.000"/>
                            <input type="hidden" class="numeric" id="Domallo3ViewMax" />
                            <input type="hidden" asp-for="Domallo3" value="0" class="form-control" readonly />
                            <span asp-validation-for="Domallo3" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 domestic">
                        <label asp-for="AllowanceOption" class="control-label col-md-4">
                            Accommodation & Local Transport
                        </label>
                        <div class="input-group col-md-7">
                            <span class="input-group-addon"></span>
                            <select asp-for="AllowanceOption" asp-items="@ViewBag.Option" class="form-control" style="width:100%">
                                <option disabled selected>-- Select Type --</option>
                            </select>
                            <span asp-validation-for="AllowanceOption" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 group-2-b domestic">
                        <label asp-for="Domallo6" class="control-label col-md-4">
                            Lumpsum
                        </label>
                        <div class="input-group col-md-7">
                            <span class="input-group-addon">Rp</span>
                            <input type="text" id="Domallo6View" class="form-control numeric" readonly />
                            <input type="hidden" asp-for="Domallo6" value="0" class="form-control" readonly />
                            <span asp-validation-for="Domallo6" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 group-2-a domestic">
                        <label asp-for="Domallo4" class="control-label col-md-4">
                            Accommodation
                        </label>
                        <div class="input-group col-md-7">
                            <span class="input-group-addon">Rp</span>
                            <input type="text" id="Domallo4View" class="form-control numeric calculate" />
                            <input type="hidden" class="numeric" id="Domallo4ViewMax" />
                            <input type="hidden" asp-for="Domallo4" value="0" class="form-control" readonly />
                            <span asp-validation-for="Domallo4" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 group-2-a domestic">
                        <label asp-for="Domallo5" class="control-label col-md-4">
                            Meal and Transport Allowance
                        </label>
                        <div class="input-group col-md-7">
                            <span class="input-group-addon">Rp</span>
                            <input type="text" id="Domallo5View" class="form-control numeric" readonly />
                            <input type="hidden" asp-for="Domallo5" value="0" class="form-control" readonly />
                            <span asp-validation-for="Domallo5" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 group-2-a domestic">
                        <label class="control-label col-md-4">
                        </label>
                        <div class="col-md-8 text-center">
                            <input type="hidden" id="InputOption1" class="numeric" />
                            <p><span class="labelDay">1</span> Day x <span id="TextOption1"></span></p>
                        </div>
                    </div>
                    <div class="form-group group-2 group-2-b domestic">
                        <label class="control-label col-md-4">
                        </label>
                        <div class="col-md-8 text-center">
                            <input type="hidden" id="InputOption2" class="numeric" />
                            <p><span class="labelDay">1</span> Day x <span id="TextOption2"></span></p>
                            <p>(Accomodation+Meal+Transport Allowance)</p>
                        </div>
                    </div>
                    <div class="form-group group-2 inter">
                        <label asp-for="Intallo1" class="control-label col-md-4">
                            Flight
                        </label>
                        <div class="col-md-8">
                            <input type="text" id="Intallo1View" class="form-control numeric calculate" placeholder="Actual Reimburse" />
                            <input type="hidden" asp-for="Intallo1" value="0" class="form-control" readonly />
                            <span asp-validation-for="Intallo1" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 inter">
                        <label asp-for="Intallo2" class="control-label col-md-4">
                            Accomodation
                        </label>
                        <div class="col-md-8">
                            <input type="text" id="Intallo2View" class="form-control numeric calculate" placeholder="Actual Reimburse" />
                            <input type="hidden" asp-for="Intallo2" value="0" class="form-control" readonly />
                            <span asp-validation-for="Intallo2" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 inter">
                        <label asp-for="Intallo3" class="control-label col-md-4">
                            Local Transport
                        </label>
                        <div class="col-md-8">
                            <input type="text" id="Intallo3View" class="form-control numeric calculate" placeholder="Actual Reimburse" />
                            <input type="hidden" asp-for="Intallo3" value="0" class="form-control" readonly />
                            <span asp-validation-for="Intallo3" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 inter">
                        <label asp-for="Intallo4" class="control-label col-md-4">
                            Allowance Meal
                        </label>
                        <div class="col-md-8">
                            <input type="text" id="Intallo4View" class="form-control numeric calculate" placeholder="Actual Reimburse" />
                            <input type="hidden" asp-for="Intallo4" value="0" class="form-control" readonly />
                            <span asp-validation-for="Intallo4" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 inter">
                        <label asp-for="Intallo5" class="control-label col-md-4">
                            Lumpsum Allowance (Accomodation + Meal)
                        </label>
                        <div class="col-md-8">
                            <input type="text" id="Intallo5View" class="form-control numeric calculate" placeholder="Actual Reimburse" />
                            <input type="hidden" asp-for="Intallo5" value="0" class="form-control" readonly />
                            <span asp-validation-for="Intallo5" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group group-2 inter">
                        <label asp-for="Intallo6" class="control-label col-md-4">
                            Winter Clothes Allowance <i class="fa fa-info-circle"></i>
                        </label>
                        <div class="col-md-8">
                            <input type="text" id="Intallo6View" class="form-control numeric" readonly />
                            <input type="hidden" asp-for="Intallo6" value="0" class="form-control" readonly />
                            <span asp-validation-for="Intallo6" class="text-danger"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="clearfix"></div>
    <div class="col-lg-12">
        <div class="portlet light portlet-fit portlet-form">
            <div class="portlet-title">
                <a asp-action="Index" class="btn btn-default"><i class="fa fa-arrow-left"></i>&nbsp; Back</a>
                <button type="submit" id="submitBtn" class="btn btn-primary"><i class="fa fa-save"></i>&nbsp; Save</button>
            </div>
        </div>
    </div>
    </div>
</form>

@{
    Html.RenderPartial("_DatatablesAssets");
}


@section Scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/assets/pages/scripts/role/form-validation.js"></script>
    <script>
            $(document).ready(function () {
                $common.setMenu("#menu-claim", "#menu-claim");

                $('#ClaimApproverOneId').change(function () {
                    var val = $(this).val();
                    $('#ClaimApproverTwoId').val(val).trigger('change');
                });

                var datatableOption = {
                    ajaxMethod: "POST",
                    listUrl: "/admin/api/travel/GetFlight",
                    detailUrl: "@Url.Action("Details")/",
                    editUrl: "@Url.Action("Edit")/",
                    deleteUrl: "/admin/api/travel/",
                    deleteAlertSuccess: "-",
                    columnDefs: [
                        {
                            "targets": 0,
                            "data": "departure",
                            name:"Departure.Name",
                        },
                        {
                            "targets": 1,
                            "data": "destionation",
                            name:"Destination.Name",
                        },
                        {
                            "targets": 2,
                            "data": "startDate",
                            name:"StartDate",
                            "render": function (data) {
                                var date = new Date(data);
                                return moment(date).format("DD MMM YYYY");
                            }
                        },
                        {
                            "targets": 3,
                            "data": "departure",
                            name:"Departure.Name",
                            "bSearchable": false,
                            "orderable": false,
                            "render": function (data, type, row, meta) {
                                var val = row.id;
                                return "<input type='radio' name='input-selected' class='srf' value='"+val+"'>";
                            }
                        },
                    ]
                }
                $datatables.init("#table", datatableOption);

                var table = $('#table')
                    .on('init.dt', function(e, settings, json) { disableImmediateSearchDt(e, settings, json, '#table'); })
                    .DataTable(); theDataTable = table;

                $('.group-1,.group-2,.group-3').hide();

                $('select').select2();

                FormValidation.init("#FormSubmit");

                //$.validator.methods.oldMin = $.validator.methods.min;
                $.validator.methods.min = function(value, element, param) {
                    if ($(element).hasClass("form-control") && $(element).hasClass("numeric"))
                        //use parseFloat instead, if necessary
                        value = parseInt($(element).autoNumeric('get'));
                    return this.optional(element) || param <= value;
                };

                //$.validator.methods.oldMax = $.validator.methods.max;
                $.validator.methods.max = function(value, element, param) {
                    if ($(element).hasClass("form-control") && $(element).hasClass("numeric"))
                        //use parseFloat instead, if necessary
                        value = parseInt($(element).autoNumeric('get'));
                    return this.optional(element) || param >= value;
                };

                $(".form_datetime").datepicker({
                    autoclose: true,
                    format: "dd MM yyyy",
                }).datepicker("setDate", new Date());

                $('#StartDateView').change(function () {
                    var value = $(this).val();
                    var val = my_date.date_to_db(value);
                    var EndDate = $('#EndDate').val();
                    $('#StartDate').val(val);

                    ChangeDate(val,EndDate);
                });

                $('#EndDateView').change(function () {
                    var value = $(this).val();
                    var val = my_date.date_to_db(value);
                    var StartDate = $('#StartDate').val();
                    $('#EndDate').val(val);
                    ChangeDate(StartDate,val);
                });

                $('#EndTimeView').change(function () {
                    var StartDate = $('#StartDate').val();
                    var EndDate = $('#EndDate').val();
                    ChangeDate(StartDate,EndDate);
                    Form.Calculate(ChangeDate);
                });

                $('#StartTimeView').change(function () {
                    var StartDate = $('#StartDate').val();
                    var EndDate = $('#EndDate').val();
                    ChangeDate(StartDate,EndDate);
                    Form.Calculate(ChangeDate);
                });

                $('#submitBtn').click(function (){
                    var value = $('#EndTimeView').val();
                    var value2 = $('#StartTimeView').val();
                    var text = "Start Time Trip: ";
                    var text2 = "End Time Trip: ";
                    var valueDesc = $('#Description').val();

                    var ClaimCategory = $("#ClaimCategoryId option:selected").text();

                    if (ClaimCategory == 'Travel Allowance' || 'Other Travel Allowance') {
                        if (valueDesc){
                            var string = String(valueDesc);
                            if(string.includes(text)!= 1){
                                $('#Description').val(valueDesc + " ; " + text + value2 + " ; " + text2 + value
                                    + "; " );
                            }
                        }else{
                            $('#Description').val(text + value2 + " ; " + text2 + value
                                + "; " + "Employee Level = " + $("#ClaimCategoryId option:selected").text());
                        }
                    }
                });

                var $inputSourcePath = $('#Files');
                initPlUploadWidget("#file_upload",
                    '@Url.Content("~/")file/plupload',
                    "#attachment-template",
                    "#uploaded .shortcuts",
                    "#Files",
                    function(elem) {
                        $(elem).find(".plupload_container").css("width", "80%");
                    }
                );

                $(document).on("click", ".delete-upload", function () {
                    removeAttachment(this, "#uploaded .shortcuts", '#Files');
                });

                $(".numeric").autoNumeric('init', { aSep: '.', aDec: ',', mDec: 0 });

                $('#CostCenterId').val('@ViewBag.CostCenterId').trigger('change');
                $('#NetworkNumberId').val('@ViewBag.NetworkNumberId').trigger('change');
                $('#SubOrgId').val('@ViewBag.SubOrganizatonId').trigger('change');

                // Event Trigger

                $("input#ValueView").on("focusout", function () {
                    $("input#Value").val($(this).autoNumeric('get'));
                });

                $("input#Domallo1View").on("focusout", function () {
                    $("input#Domallo1").val($(this).autoNumeric('get'));
                    var StartDate = $('#StartDate').val();
                    var EndDate = $('#EndDate').val();
                    ChangeDate(StartDate,EndDate);
                    Form.Calculate(ChangeDate);
                });

                $("input#Domallo2View").on("focusout", function () {
                    $("input#Domallo2").val($(this).autoNumeric('get'));
                    var StartDate = $('#StartDate').val();
                    var EndDate = $('#EndDate').val();
                    ChangeDate(StartDate,EndDate);
                    Form.Calculate(ChangeDate);
                });

                $("input#Domallo3View").on("focusout", function () {
                    $("input#Domallo3").val($(this).autoNumeric('get'));
                    var StartDate = $('#StartDate').val();
                    var EndDate = $('#EndDate').val();
                    ChangeDate(StartDate,EndDate);
                    Form.Calculate(ChangeDate);
                });

                $("input#Domallo4View").on("focusout", function () {
                    $("input#Domallo4").val($(this).autoNumeric('get'));
                    var StartDate = $('#StartDate').val();
                    var EndDate = $('#EndDate').val();
                    ChangeDate(StartDate,EndDate);
                    Form.Calculate(ChangeDate);
                });

                $("input#Intallo1View").on("focusout", function () {
                    $("input#Intallo1").val($(this).autoNumeric('get'));
                });

                $("input#Intallo2View").on("focusout", function () {
                    $("input#Intallo2").val($(this).autoNumeric('get'));
                });

                $("input#Intallo3View").on("focusout", function () {
                    $("input#Intallo3").val($(this).autoNumeric('get'));
                });

                $("input#Intallo4View").on("focusout", function () {
                    $("input#Intallo4").val($(this).autoNumeric('get'));
                });

                $("input#Intallo5View").on("focusout", function () {
                    $("input#Intallo5").val($(this).autoNumeric('get'));
                });

                $('#ClaimCategoryId').change(function () {
                    var text = $("#ClaimCategoryId option:selected").text();
                    Form.change(text);
                    //document.getElementById("sdd").disable='true';
                });

                $('#EmployeeLevel').change(function () {
                    var text = $("#ClaimCategoryId option:selected").text();
                    Form.change(text);
                    //document.getElementById("sdd").disable='true';
                });

                $('#TripType').change(function(){
                    var val = $(this).val();
                    if(val=='1'){
                        $('.domestic').show();
                        $('.inter').hide();

                        var val = $('#AllowanceOption').val();
                        if (val == '1') {
                            $('.group-2-a').show();
                            $('.group-2-b').hide();
                        } else {
                            $('.group-2-a').hide();
                            $('.group-2-b').show();
                        }
                        $('.ChangeDate').trigger('change');

                    }else{
                        $('.inter').show();
                        $('.domestic').hide();
                    }
                    var StartDate = $('#StartDate').val();
                    var EndDate = $('#EndDate').val();
                    ChangeDate(StartDate,EndDate);
                    Form.Calculate(ChangeDate);
                });

                $('#DayType').change(function () {
                    var val = $(this).val();
                    $.ajax({
                        url: "/Admin/Api/Claim/GetAllowance", success: function (result) {
                            var ClaimCategory = $("#ClaimCategoryId option:selected").text();

                            if (ClaimCategory == 'On Call Allowance') {
                                if (val == '1') {
                                    $("#OnCallShiftView").val(result.onCallNormal).trigger('focusout');
                                    $("#OnCallShift").val(result.onCallNormal);
                                    $('#GrandValue').text($("#OnCallShiftView").val());
                                    var StartDate = $('#StartDate').val();
                                    var EndDate = $('#EndDate').val();
                                    ChangeDate(StartDate,EndDate);

                                } else {
                                    $("#OnCallShiftView").val(result.onCallHoliday).trigger('focusout');
                                    $("#OnCallShift").val(result.onCallHoliday);
                                    $('#GrandValue').text($("#OnCallShiftView").val());
                                    var StartDate = $('#StartDate').val();
                                    var EndDate = $('#EndDate').val();
                                    ChangeDate(StartDate,EndDate);
                                }
                            }

                            if(ClaimCategory == 'Shift Allowance'){
                                if (val == '1') {
                                    $("#OnCallShiftView").val(result.shiftNormal).trigger('focusout');
                                    $("#OnCallShift").val(result.shiftNormal);
                                    $('#GrandValue').text($("#OnCallShiftView").val());
                                    var StartDate = $('#StartDate').val();
                                    var EndDate = $('#EndDate').val();
                                    ChangeDate(StartDate,EndDate);

                                } else {
                                    $("#OnCallShiftView").val(result.shiftHoliday).trigger('focusout');
                                    $("#OnCallShift").val(result.shiftHoliday);
                                    $('#GrandValue').text($("#OnCallShiftView").val());
                                    var StartDate = $('#StartDate').val();
                                    var EndDate = $('#EndDate').val();
                                    ChangeDate(StartDate,EndDate);

                                }
                            }


                        }
                    });
                });

                $('#AllowanceOption').change(function () {
                    var val = $(this).val();
                    if (val == '1') {
                        $('.group-2-a').show();
                        $('.group-2-b').hide();
                    } else {
                        $('.group-2-a').hide();
                        $('.group-2-b').show();
                    }
                    $('.ChangeDate').trigger('change');
                    var StartDate = $('#StartDate').val();
                    var EndDate = $('#EndDate').val();
                    ChangeDate(StartDate,EndDate);
                    Form.Calculate(ChangeDate);
                });

                var Form = {
                    change: function (val) {
                        if (val == 'Other Travel Allowance') {
                            $('.group-1,.group-2').hide();
                            $('#DateFirst').text('Date');
                            $('#DateLast').text('Date');
                            $('.group12').show();
                            document.getElementById('ValueView').readOnly=false;
                        }
                        if (val == 'On Call Allowance') {
                            $('.group-2').hide();
                            $('.group-1').show();
                            $('#DayType').val('1').trigger('change');
                            $('#DateFirst').text('Start Date');
                            $('#DateLast').text('End Date');
                            $('.group12').hide();
                            document.getElementById('ValueView').readOnly=true;
                        }
                        if (val == 'Shift Allowance') {
                            $('.group-2').hide();
                            $('.group-1').show();
                            $('#DayType').val('1').trigger('change');
                            $('#DateFirst').text('Start Date');
                            $('#DateLast').text('End Date');
                            $('.group12').hide();
                            document.getElementById('ValueView').readOnly=true;
                        }
                        if (val == 'Travel Allowance') {
                            $('.group-1').hide();
                            $('.group-2').show();
                            $('#DateFirst').text('Departure Date');
                            $('#DateLast').text('Return Date');
                            $('#TripType').val('1').trigger("change");
                            $('#AllowanceOption').val('1').trigger("change");
                            document.getElementById('ValueView').readOnly=true;
                            $('.group12').show();
                        }
                        var StartDate = $('#StartDate').val();
                        var EndDate = $('#EndDate').val();
                        ChangeDate(StartDate,EndDate);
                        Form.Calculate(ChangeDate);
                        //Form.Calculate();
                    },

                    Calculate: function (duration) {
                        var AllowForm = @ViewBag.AllowForm;
                        //var IsManager = @ViewBag.IsManager;
                        var IsManager = $('#EmployeeLevel').val();
                        var AccomodationManager = parseInt(AllowForm[0]) || 0;
                        var AccomodationStaff = parseInt(AllowForm[1]) || 0;
                        var LocalAirPort = parseInt(AllowForm[2]) || 0;
                        var LocalTransport = parseInt(AllowForm[3]) || 0;
                        var LumpusManager = parseInt(AllowForm[4]) || 0;
                        var LumpsumStaff = parseInt(AllowForm[5]) || 0;
                        var MealAndTransportManager = parseInt(AllowForm[6]) || 0;
                        var MealAndTransportStaff = parseInt(AllowForm[7]) || 0;
                        var MaxAccomodationManager;
                        var MaxAccomodationStaff;
                        var maxLocalTransportHome;
                        var maxLocalTransportHotel;

                        maxLocalTransportHome = 350000;
                        maxLocalTransportHotel = 200000;

                        var dateStart = $('#StartTimeView').val().split(':');
                        var hourStart = dateStart[0];

                        var dateEnd = $('#EndTimeView').val().split(':');
                        var hourEnd = dateEnd[0];

                        if (duration == 1)
                        {
                            if(hourStart > 11 || hourEnd < 19){
                                duration = duration - 0.5;
                                $('.labelDay').text(duration);
                            }

                            MealAndTransportManager = MealAndTransportManager * duration;
                            MealAndTransportStaff = MealAndTransportStaff * duration;
                            LumpusManager  = LumpusManager * duration;
                            LumpsumStaff  = LumpsumStaff * duration;
                            MaxAccomodationManager = AccomodationManager * duration;
                            MaxAccomodationStaff = AccomodationStaff * duration;
                        }

                        if (duration > 1)
                        {
                            if(hourStart > 11){
                                duration = duration - 0.5;
                                $('.labelDay').text(duration);
                            }
                            if(hourEnd < 19){
                                duration = duration - 0.5;
                                $('.labelDay').text(duration);
                            }
                            MealAndTransportManager = MealAndTransportManager * duration;
                            MealAndTransportStaff = MealAndTransportStaff * duration;
                            LumpusManager  = LumpusManager * duration;
                            LumpsumStaff  = LumpsumStaff * duration;
                            MaxAccomodationManager = AccomodationManager * duration;
                            MaxAccomodationStaff = AccomodationStaff * duration;
                        }



                        var WinterClothes = parseInt(AllowForm[8]) || 0;
                        //$('#EmployeeLevel').val(IsManager).trigger('change');
                        //$('.EmployeeLevel').trigger('change');


                        if (IsManager == '1') {
                            $("#Domallo5View").val(MealAndTransportManager).trigger('focusout');
                            $("#Domallo5").val(MealAndTransportManager);
                            $('#InputOption1').val(parseInt(AllowForm[6]) || 0).trigger('focusout');
                            $('#TextOption1').text($('#InputOption1').val());
                            $("#Domallo6View").val(LumpusManager).trigger('focusout');
                            $("#Domallo6").val(LumpusManager);
                            $('#InputOption2').val(parseInt(AllowForm[4]) || 0).trigger('focusout');
                            $('#TextOption2').text($('#InputOption2').val());
                            if (MaxAccomodationManager) {
                                $("#Domallo4View").prop("min", 0);
                                $("#Domallo4View").prop("max", MaxAccomodationManager);
                                //$("#Domallo4View").max(MaxAccomodationManager);
                                Form.UpdateValidationMaxRule("Domallo4View", MaxAccomodationManager);
                                $("#Domallo4ViewMax").autoNumeric('set', MaxAccomodationManager);
                                $("#Domallo4View").prop("placeholder", "Max " + $("#Domallo4ViewMax").val());
                            }
                        } else {
                            $("#Domallo5View").val(MealAndTransportStaff).trigger('focusout');
                            $("#Domallo5").val(MealAndTransportStaff);
                            $('#InputOption1').val(parseInt(AllowForm[7]) || 0).trigger('focusout');
                            $('#TextOption1').text($('#InputOption1').val());
                            $("#Domallo6View").val(LumpsumStaff).trigger('focusout');
                            $("#Domallo6").val(LumpsumStaff);
                            $('#InputOption2').val(parseInt(AllowForm[5]) || 0).trigger('focusout');
                            $('#TextOption2').text($('#InputOption2').val());
                            if (MaxAccomodationStaff) {
                                $("#Domallo4View").prop("min", 0);
                                $("#Domallo4View").prop("max", MaxAccomodationStaff);
                                //$("#Domallo4View").max(MaxAccomodationStaff);
                                Form.UpdateValidationMaxRule("Domallo4View", MaxAccomodationStaff);
                                $("#Domallo4ViewMax").autoNumeric('set', MaxAccomodationStaff);
                                $("#Domallo4View").prop("placeholder", "Max " + $("#Domallo4ViewMax").val());
                            }
                            if (maxLocalTransportHome) {
                                $("#Domallo2View").prop("min", 0);
                                $("#Domallo2View").prop("max", maxLocalTransportHome);
                                //$("#Domallo4View").max(MaxAccomodationStaff);
                                Form.UpdateValidationMaxRule("Domallo2View", maxLocalTransportHome);
                                $("#Domallo2ViewMax").autoNumeric('set', maxLocalTransportHome);
                                $("#Domallo2View").prop("placeholder", "Max " + $("#Domallo2ViewMax").val());
                            }
                            if (maxLocalTransportHotel) {
                                $("#Domallo3View").prop("min", 0);
                                $("#Domallo3View").prop("max", maxLocalTransportHotel);
                                //$("#Domallo4View").max(MaxAccomodationStaff);
                                Form.UpdateValidationMaxRule("Domallo3View", maxLocalTransportHotel);
                                $("#Domallo3ViewMax").autoNumeric('set', maxLocalTransportHotel);
                                $("#Domallo3View").prop("placeholder", "Max " + $("#Domallo3ViewMax").val());
                            }
                        }

                        var ClaimCategory = $("#ClaimCategoryId option:selected").text();

                        if (ClaimCategory == 'Other Travel Allowance') {
                            $('#GrandInput').val('0').trigger('focusout');
                            $('#GrandValue').text('0');
                        }

                        if (ClaimCategory == 'Travel Allowance') {

                            $('#GrandInput').val('0').trigger('focusout');
                            $('#GrandValue').text('0');

                            var TripType = $('#TripType').val();
                            if (TripType == '1') {

                                //$("#Domallo2View").val(LocalTransport).trigger('focusout');
                                //$("#Domallo2").val(LocalTransport);

                                //$("#Domallo3View").val(LocalAirPort).trigger('focusout');
                                //$("#Domallo3").val(LocalAirPort);

                                var Grand = parseInt(0);
                                var Option = $('#AllowanceOption').val();

                                if (Option == '1') {
                                    var FlightAir = parseInt($("#Domallo1View").autoNumeric('get')) || 0;
                                    var LocalTransportHome = parseInt($("#Domallo2View").autoNumeric('get'));
                                    var LocalTransportAirPort = parseInt($("#Domallo3View").autoNumeric('get'));
                                    var Accomodation =  parseInt($("#Domallo4View").autoNumeric('get')) || 0;
                                    var MealTransport =  parseInt($("#Domallo5View").autoNumeric('get')) || 0;
                                    var Lumpsum =  parseInt($("#Domallo6View").autoNumeric('get')) || 0;
                                    var Grand = FlightAir + LocalTransportHome + LocalTransportAirPort + Accomodation + MealTransport;
                                } else {
                                    var FlightAir = parseInt($("#Domallo1View").autoNumeric('get')) || 0;
                                    var LocalTransportHome = parseInt($("#Domallo2View").autoNumeric('get'));
                                    var LocalTransportAirPort = parseInt($("#Domallo3View").autoNumeric('get'));
                                    var Lumpsum =  parseInt($("#Domallo6View").autoNumeric('get')) || 0;
                                    var MealTransport =  parseInt($("#Domallo5View").autoNumeric('get')) || 0;
                                    var Grand = FlightAir + LocalTransportHome + LocalTransportAirPort + Lumpsum;
                                }

                                $('#GrandInput').val(Grand).trigger('focusout');
                                $('#GrandValue').text($('#GrandInput').val());

                            }else{

                                $("#Intallo6View").val(WinterClothes).trigger('focusout');
                                $("#Intallo6").val(WinterClothes);

                                var IntAllow1 =  parseInt($("#Intallo1View").autoNumeric('get')) || 0;
                                var IntAllow2 =  parseInt($("#Intallo2View").autoNumeric('get')) || 0;
                                var IntAllow3 =  parseInt($("#Intallo3View").autoNumeric('get')) || 0;
                                var IntAllow4 =  parseInt($("#Intallo4View").autoNumeric('get')) || 0;
                                var IntAllow5 =  parseInt($("#Intallo5View").autoNumeric('get')) || 0;
                                var IntAllow6 =  parseInt($("#Intallo6View").autoNumeric('get')) || 0;
                                var Grand = IntAllow1 + IntAllow2 + IntAllow3 + IntAllow4 + IntAllow5 + IntAllow6;

                                $('#GrandInput').val(Grand).trigger('focusout');
                                $('#GrandValue').text($('#GrandInput').val());
                            }
                        }
                        $("input#Value").val($('#GrandInput').autoNumeric('get'));
                        $("input#ValueView").val($('#GrandInput').val());
                    },

                    UpdateValidationMaxRule: function (elementId, amount) {
                        $("#" + elementId).rules("add", {
                            max: amount });
                        $(".form-control").each(function (i, obj) {
                            if ($(this).prop("id") !== "" && $(this).prop("id") !== elementId && $(this).rules())
                                $(this).rules("remove", "max");
                            $(this).rul
                        });
                    }
                };

                $('.calculate').on('keyup change', function (e) {
                    Form.Calculate();
                });

                var ChangeDate = function (StartDate, EndDate) {
                    if (!StartDate || !EndDate) return;
                    $.ajax({
                        url: "/Admin/Api/Claim/CheckHolidays?first="+StartDate+"&last="+EndDate, success: function (result) {
                            if (result.message != false) {
                                $('#DayType').val(result.message).trigger('change');
                            }
                            if (parseInt(result.total) != -1) {
                                var Total = parseInt(result.total);
                                var inputToDoVal = parseInt($("#OnCallShift").val());
                                var totalValue = Total * inputToDoVal;
                                $('.labelDay').text(Total);
                                Form.Calculate(Total);

                                var ClaimCategory = $("#ClaimCategoryId option:selected").text();

                                if (ClaimCategory == 'Travel Allowance') {
                                    //$('#GrandInput').val('0').trigger('focusout');
                                    //$('#GrandValue').text('0');
                                    $("input#Value").val($('#GrandInput').autoNumeric('get'));
                                    $("input#ValueView").val($('#GrandInput').val());
                                }
                                if (ClaimCategory == 'Shift Allowance') {
                                    $("input#ValueView").val(totalValue);
                                    $("input#ValueView").val(totalValue).trigger('focusout');
                                }
                                if (ClaimCategory == 'On Call Allowance') {
                                    $("input#ValueView").val(totalValue);
                                    $("input#ValueView").val(totalValue).trigger('focusout');
                                }
                            }
                        }
                    });
                };

                $('#StartDateView').trigger('change');
                $('#EndDateView').trigger('change');
            });

    </script>
    <script type="text/template" id="attachment-template">
        <div class="column">
            <div class="inner">
                <div class="img-wrap">
                    <div class="wrapper-control">
                        <div class="btn-group" style="margin-bottom:5px !important;">
                            <a class="btn btn-success btn-sm tools-nav" href="@Url.Content("~/"){{path}}" download><i class="fa fa fa-paperclip"></i> {{name}} ({{size}}KB)</a>
                            <a class="btn btn-success btn-sm tools-nav delete-upload" data-to-delete="{{path}}"><i class="fa fa-times"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </script>
}
